---
title: UEFI 和 BIOS 知识整理
author: network
date: 2024-05-24
category: note
layout: post
mermaid: true
---

### 一、 BIOS和UEFI启动，有什么不同
1、BIOS
BIOS启动，只认识设备。所以事先约定好读取设备的哪个部分才能保证正常读取引导。因此需要定义一个主引导记录，位于硬盘的 ` 柱面0 磁头0 扇区1 ` 。它的大小是512B，由3部分构成：***主引导程序446B+DPT硬盘分区表64B+磁盘有效标志0x55 0xAA***

启动时，BIOS按照保存的设备启动顺序依次检索设备的有效标志。如果不是55AA，则跳过，是，则表示可启动，转而去读主引导程序。

正是因为BIOS读取的位置固定这个特性，使得一个设备只会出现一个引导程序，后加入的程序会覆盖先前的引导。

2、UEFI
UEFI不但认识设备，还认识分区，更认识文件。
因为UEFI在启动的时候进行了一系列初始化操作。加载设备的驱动。
加载驱动前，主板只知道当前它访问的设备是个什么东西
在加载驱动之后，主板就能知道这个设备的详细信息。

至于需要加载什么，以及要依照什么顺序去检索这些设备可否启动，这些就都是从BIOS存储的设备序列来读取出来了。
与传统方式相同，UEFI在BIOS中同样保存了一个启动顺序，UEFI会根据这个序列去依次查找启动项。
至于启动项，EFI又分成两个：文件启动项和设备启动项。

>文件启动项，即一个指向明确文件存储位置的启动项。使用这个启动项，UEFI会直接去往这个位置来加载执行。

>设备启动项，则只指向一个设备。对于这种启动项，UEFI定义了一个标准，即如果这个设备可以启动，那么这个设备的efi引导文件一定是/efi/boot/bootx64.efi。对于一个设备启动项，EFI会直接执行这个路径下面的文件。如果可执行则继续，找不到则报失败。

对于UEFI+GPT，UEFI又有一个标准，即这个硬盘如果可以启动，则需要有一个EFI分区（ESP），格式为FAT32，而文件启动项放置在路径/EFI/厂商名下。这便是一个ESP分区最基本的结构。

---
### 二、如何指定一个EFI启动项


因为有两种启动项，所以启动自然分为两种情况

1、选择从哪个硬件启动
在用户选择了启动磁盘后，UEFI会在这个磁盘中寻找EFI分区，然后找这个分区下的/EFI/Boot/bootx64.efi（UEFI可以执行的二进制文件），由这个文件进行下一步操作（引导操作系统），这个文件通常由操作系统给出，在光盘/EFI/BOOT目录下。

2、选择用哪个文件启动项启动
这个启动项记录了引导文件(*.efi)所在的磁盘和分区以及文件名，直接执行这个efi文件即可开始进行下一步操作（引导操作系统）


---
### 三、常见问题


1. **有Windows，又装了Linux双系统，为什么不能引导到Linux上？**

装好Linux后，EFI系统自然会创建对应的文件启动项。这个启动项对应着GRUB引导程序，它可以识别并启动到Linux和Windows中。
而Windows自身的Windows Boot Manager，只能识别微软系列的系统。
所以如果Windows Boot Manager排列在了最前方，自然就不能引导到Linux中了。解决办法就是进入你的BIOS，将GRUB的引导项移动到最上方的位置。

反之，删除Linux后Windows的引导回不来，就是因为Windows Boot Manager被放在了最下方，挪上去就可以了。  

2. **如何将文件启动项转化为 硬盘启动项**

 硬盘启动项 文件在硬盘ESP分区的`/efi/boot/bootx64.efi `

 文件启动项 文件在硬盘ESP分区的/efi//厂商/xxxx.efi 
 例如：`\EFI\Microsoft\Boot\bootmgfw.efi` 
 `\EFI\Manjaro\grubx64.efi`  

 文件启动项和硬盘启动项的文件没有区别，只不过 硬盘启动项的储存位置(/efi/boot/)和文件名称(bootx64.efi)固定，所以一个硬盘只能有一个硬盘启动项，而文件启动项 可以在 efibootmgr 中 设定 储存位置和文件名称，所以一个硬盘可以设置多个启动程序，故只需找到软件启动项的文件复制到 硬盘启动项的位置，更改名称即可。 
 


